{% extends "base.html" %}
{% block title %}Dashboard | Carbon Credits{% endblock %}

{% block content %}
<div class="container my-5">
    <h1 class="text-success mb-4">{{ user.username }}'s Dashboard</h1>


    <nav aria-label="breadcrumb">
        <ol class="breadcrumb">
            <li class="breadcrumb-item"><a href="{{ url_for('home') }}">Home</a></li>
            <li class="breadcrumb-item active" aria-current="page">Dashboard</li>
        </ol>
    </nav>

    <div class="dashboard-container">
        
       
        <section class="profile-card mb-5">
            <div class="card shadow-sm border-0 p-4">
                <h4 class="fw-bold text-success">ðŸ‘¤ Profile Overview</h4>
                <p><strong>Wallet Balance:</strong> â‚¹{{ "%.2f"|format(user.wallet_balance) }}</p>
                <p><strong>Carbon Credits:</strong> {{ "%.2f"|format(user.credits) }}</p>
            </div>
        </section>

       
        <section class="graph-section mb-5">
            <div class="card shadow-sm border-0 p-4">
                <h4 class="fw-bold text-success mb-3">ðŸ“Š Emission Overview</h4>
                {% if emission_data %}
                    <canvas id="emissionChart"></canvas>
                {% else %}
                    <p class="text-muted">No emission data recorded yet.</p>
                {% endif %}
            </div>
        </section>

        <section class="table-section mb-5">
            <div class="card shadow-sm border-0 p-4">
                <h4 class="fw-bold text-success mb-3">ðŸ›’ Marketplace Transactions</h4>
                {% if marketplace_transactions %}
                    <div class="table-responsive">
                        <table class="table table-bordered align-middle">
                            <thead class="table-success">
                                <tr>
                                    <th>Date</th>
                                    <th>Details</th>
                                    <th>Credits Bought</th>
                                </tr>
                            </thead>
                            <tbody>
                                {% for t in marketplace_transactions %}
                                <tr>
                                    <td>{{ t.date }}</td>
                                    <td>{{ t.program_name }}</td>
                                    <td>{{ t.credits_used }}</td>
                                </tr>
                                {% endfor %}
                            </tbody>
                        </table>
                    </div>
                {% else %}
                    <p class="text-muted">No marketplace transactions yet.</p>
                {% endif %}
            </div>
        </section>

        
        <section class="table-section mb-5">
            <div class="card shadow-sm border-0 p-4">
                <h4 class="fw-bold text-success mb-3">ðŸŒ± Offset Transactions</h4>
                {% if offset_transactions %}
                    <div class="table-responsive">
                        <table class="table table-bordered align-middle">
                            <thead class="table-success">
                                <tr>
                                    <th>Date</th>
                                    <th>Program</th>
                                    <th>COâ‚‚ Offset (kg)</th>
                                    <th>Credits Used</th>
                                </tr>
                            </thead>
                            <tbody>
                                {% for o in offset_transactions %}
                                <tr>
                                    <td>{{ o.date }}</td>
                                    <td>{{ o.program_name }}</td>
                                    <td>{{ o.co2_offset }}</td>
                                    <td>{{ o.credits_spent }}</td>
                                </tr>
                                {% endfor %}
                            </tbody>
                        </table>
                    </div>
                {% else %}
                    <p class="text-muted">No offset transactions recorded yet.</p>
                {% endif %}
            </div>
        </section>
    </div>
</div>


<script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
<script>
    {% if emission_data %}
    const ctx = document.getElementById('emissionChart').getContext('2d');
    const emissionChart = new Chart(ctx, {
        type: 'line',
        data: {
            labels: {{ emission_data | map(attribute='date') | list | tojson }},
            datasets: [{
                label: 'Daily Emissions (kg COâ‚‚)',
                data: {{ emission_data | map(attribute='amount') | list | tojson }},
                borderColor: '#4CAF50',
                backgroundColor: 'rgba(76, 175, 80, 0.2)',
                borderWidth: 2,
                fill: true,
                tension: 0.3,
                pointRadius: 5,
                pointHoverRadius: 7
            }]
        },
        options: {
            responsive: true,
            scales: {
                x: {
                    title: { display: true, text: 'Date' }
                },
                y: {
                    title: { display: true, text: 'COâ‚‚ Emissions (kg)' },
                    beginAtZero: true
                }
            }
        }
    });
    {% endif %}
</script>

{% endblock %}
