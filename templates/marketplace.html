{% extends 'base.html' %}
{% block content %}
<div class="container mt-5">
  <h2 class="text-center mb-4">Carbon Credit Marketplace</h2>

  <div class="text-center mb-4">
    <a href="{{ url_for('create_listing') }}" class="btn btn-primary">+ Create New Listing</a>
  </div>

  {% if listings %}
  <h4 class="text-center mb-3 text-success">Available Listings</h4>
  <div class="row justify-content-center">
    {% for listing in listings %}
      <div class="col-md-4 mb-4">
        <div class="card shadow-sm text-center p-3">
          <h5>Seller: {{ listing.user.username }}</h5>
          <p>{{ listing.credits }} Credits @ ₹{{ listing.price_per_credit }} each</p>
          <p><strong>Total:</strong> ₹{{ listing.total_price }}</p>
          <form action="{{ url_for('buy_credits', listing_id=listing.id) }}" method="POST">
            <button type="submit" class="btn btn-success">Buy Credits</button>
          </form>
        </div>
      </div>
    {% endfor %}
  </div>
  {% else %}
  <p class="text-center text-muted mt-4">No available listings right now.</p>
  {% endif %}

  {% if user_listings %}
  <hr>
  <h4 class="text-center mb-3 text-secondary">Your Listings</h4>
  <div class="row justify-content-center">
    {% for listing in user_listings %}
      <div class="col-md-4 mb-4">
        <div class="card shadow-sm text-center p-3">
          <p><strong>{{ listing.credits }}</strong> Credits @ ₹{{ listing.price_per_credit }} each</p>
          <p>Status: 
            {% if listing.status == 'available' %}
              <span class="text-success">Available</span>
            {% else %}
              <span class="text-danger">Sold</span>
            {% endif %}
          </p>
        </div>
      </div>
    {% endfor %}
  </div>
  {% endif %}
</div>
{% endblock %}
